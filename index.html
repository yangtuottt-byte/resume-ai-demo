<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 智能简历筛选系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen text-gray-800">
    <div id="app" class="container mx-auto px-4 py-10 max-w-4xl">
        
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-blue-600 mb-2">
                <i class="fa-solid fa-robot"></i> AI 智能简历筛选
            </h1>
            <p class="text-gray-500">上传 PDF 简历，输入 JD，一键获取解析与评分</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-xl shadow-lg h-fit">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">1. 岗位描述 (JD)</label>
                    <textarea v-model="jdText" rows="6" 
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                        placeholder="请粘贴职位描述，例如：我们需要一名熟悉 Python 和 AWS 的后端工程师..."></textarea>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">2. 上传简历 (PDF)</label>
                    <div class="flex items-center justify-center w-full">
                        <label for="dropzone-file" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                <i class="fa-solid fa-cloud-arrow-up text-2xl text-gray-400 mb-2"></i>
                                <p class="text-sm text-gray-500" v-if="!selectedFile">点击上传 PDF 文件</p>
                                <p class="text-sm text-blue-600 font-semibold" v-else>{{ selectedFile.name }}</p>
                            </div>
                            <input id="dropzone-file" type="file" class="hidden" accept=".pdf" @change="handleFileChange" />
                        </label>
                    </div>
                </div>

                <button @click="analyze" :disabled="loading"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 flex justify-center items-center disabled:opacity-50">
                    <span v-if="loading"><i class="fa-solid fa-circle-notch fa-spin mr-2"></i> 分析中...</span>
                    <span v-else>开始智能分析</span>
                </button>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg min-h-[400px]">
                <h2 class="text-xl font-bold mb-4 border-b pb-2">分析报告</h2>
                
                <div v-if="!result && !loading" class="text-center text-gray-400 mt-20">
                    <i class="fa-solid fa-chart-pie text-5xl mb-4"></i>
                    <p>暂无数据，请在左侧提交分析</p>
                </div>

                <div v-if="loading" class="flex flex-col items-center justify-center mt-20 text-blue-500">
                    <i class="fa-solid fa-spinner fa-spin text-4xl mb-4"></i>
                    <p>正在读取 PDF 并咨询 AI 模型...</p>
                </div>

                <div v-if="result" class="animate-fade-in">
                    <div class="flex items-center justify-between bg-blue-50 p-4 rounded-lg mb-6">
                        <div>
                            <p class="text-sm text-gray-500">匹配评分</p>
                            <p class="text-3xl font-bold" :class="getScoreColor(result.match_analysis.score)">
                                {{ result.match_analysis.score }} <span class="text-sm text-gray-400">/ 100</span>
                            </p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-gray-800">{{ result.candidate_info.name }}</p>
                            <p class="text-sm text-gray-500">{{ result.candidate_info.education }} · {{ result.candidate_info.years_exp }}</p>
                        </div>
                    </div>

                    <div class="mb-4 text-sm text-gray-600 grid grid-cols-2 gap-2">
                        <p><i class="fa-solid fa-phone mr-2"></i>{{ result.candidate_info.email }}</p>
                    </div>

                    <div class="mb-4">
                        <p class="font-semibold mb-2 text-sm">技能栈：</p>
                        <div class="flex flex-wrap gap-2">
                            <span v-for="skill in result.candidate_info.skills" class="bg-gray-200 text-gray-700 px-2 py-1 rounded text-xs">
                                {{ skill }}
                            </span>
                        </div>
                    </div>

                    <div class="mb-4">
                        <p class="font-semibold mb-2 text-sm text-green-600">匹配关键词：</p>
                        <p class="text-sm text-gray-600">{{ result.match_analysis.keyword_match.join(', ') }}</p>
                    </div>

                    <div class="mb-4">
                        <p class="font-semibold mb-2 text-sm text-red-500">缺失技能/不足：</p>
                        <p class="text-sm text-gray-600">{{ result.match_analysis.missing_skills.join(', ') }}</p>
                    </div>

                    <div class="bg-gray-50 p-3 rounded text-sm italic border-l-4 border-blue-400">
                        "{{ result.match_analysis.summary }}"
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref } = Vue;

        createApp({
            setup() {
                const jdText = ref('');
                const selectedFile = ref(null);
                const loading = ref(false);
                const result = ref(null);

                // *** ⚠️注意：请把下面的地址替换为你刚才在阿里云获取的公网地址 + /analyze ***
                const API_URL = 'https://resume-anaysis-ncygutrcce.cn-hangzhou.fcapp.run/analyze'; 

                const handleFileChange = (event) => {
                    selectedFile.value = event.target.files[0];
                };

                const getScoreColor = (score) => {
                    if (score >= 80) return 'text-green-600';
                    if (score >= 60) return 'text-yellow-600';
                    return 'text-red-600';
                };

                const analyze = async () => {
                    if (!selectedFile.value || !jdText.value) {
                        alert('请确保已输入JD并上传了简历PDF');
                        return;
                    }

                    loading.value = true;
                    result.value = null;

                    const formData = new FormData();
                    formData.append('file', selectedFile.value);
                    formData.append('jd', jdText.value);

                    try {
                        const response = await fetch(API_URL, {
                            method: 'POST',
                            body: formData
                        });

                        if (!response.ok) throw new Error('API request failed');
                        
                        const data = await response.json();
                        result.value = data;
                    } catch (error) {
                        console.error(error);
                        alert('分析失败，请检查网络或后端服务是否正常。');
                    } finally {
                        loading.value = false;
                    }
                };

                return {
                    jdText,
                    selectedFile,
                    loading,
                    result,
                    handleFileChange,
                    analyze,
                    getScoreColor
                };
            }
        }).mount('#app');
    </script>
</body>
</html>